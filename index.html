<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <title>kadai5</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        .unknown_element {
            font-weight: normal;
            background-color: aliceblue;
            color: gray;
        }
        .remembered_element {
            font-weight: bold;
            background-color: honeydew;
            color: green;
        }
        .wrong_answered_element {
            background-color: lightyellow;
            font-weight: bold;
            color: orange;
        }

        .correct_sign {
            border-radius: 5px;
            padding: 4px;
            font-size: 0.8em;
            font-weight: bold;
            background-color: rgb(92, 184, 92);
            color: white;
        }
        .incorrect_sign {
            border-radius: 5px;
            padding: 4px;
            font-size: 0.8em;
            font-weight: bold;
            background-color: rgb(240, 173, 78);
            color: white;
        }

        .element_button {
            width: 2.5em;
        }

        .element_table_td{
            width: 30px;
            border-radius: 5px;
        }

        #element_view > p {
            width: 300px;
            background-color: white;
            border-radius: 30px;
            margin: 7px;
        }

        #element_view {
            background-color: rgb(60, 131, 192);
            margin: 20px 0;
            padding: 20px calc((100% - 450px) / 2);
        }

        #element_view_symbol {
            font-size: 8em;
            margin: 0;
            font-weight: bold;
        }

        #element_view_en {
            font-size: 1.3em;
            font-weight: bold;
        }

        #element_view_jp {
            font-size: 1.3em;
            font-weight: bold;
        }

        #quiz_result_table td {
            padding: 0 20px;
        }
    </style>

    <script type="text/javascript">

        // 元素情報
        const elements = [
            { num: 1, symbol: "H", jp: "水素", en: "Hydrogen", group: "1", period: "1", row: 0, column: 0 },
            { num: 2, symbol: "He", jp: "ヘリウム", en: "Helium", group: "1", period: "18", row: 0, column: 17 },
            { num: 3, symbol: "Li", jp: "リチウム", en: "Lithium", group: "2", period: "1", row: 1, column: 0 },
            { num: 4, symbol: "Be", jp: "ベリリウム", en: "Beryllium", group: "2", period: "2", row: 1, column: 1 },
            { num: 5, symbol: "B", jp: "ホウ素", en: "Boron", group: "2", period: "13", row: 1, column: 12 },
            { num: 6, symbol: "C", jp: "炭素", en: "Carbon", group: "2", period: "14", row: 1, column: 13 },
            { num: 7, symbol: "N", jp: "窒素", en: "Nitrogen", group: "2", period: "15", row: 1, column: 14 },
            { num: 8, symbol: "O", jp: "酸素", en: "Oxygen", group: "2", period: "16", row: 1, column: 15 },
            { num: 9, symbol: "F", jp: "フッ素", en: "Fluorine", group: "2", period: "17", row: 1, column: 16 },
            { num: 10, symbol: "Ne", jp: "ネオン", en: "Neon", group: "2", period: "18", row: 1, column: 17 },
            { num: 11, symbol: "Na", jp: "ナトリウム", en: "Sodium", group: "3", period: "1", row: 2, column: 0 },
            { num: 12, symbol: "Mg", jp: "マグネシウム", en: "Magnesium", group: "3", period: "2", row: 2, column: 1 },
            { num: 13, symbol: "Al", jp: "アルミニウム", en: "Aluminium", group: "3", period: "13", row: 2, column: 12 },
            { num: 14, symbol: "Si", jp: "ケイ素", en: "Silicon", group: "3", period: "14", row: 2, column: 13 },
            { num: 15, symbol: "P", jp: "リン", en: "Phosphorus", group: "3", period: "15", row: 2, column: 14 },
            { num: 16, symbol: "S", jp: "硫黄", en: "Sulfur", group: "3", period: "16", row: 2, column: 15 },
            { num: 17, symbol: "Cl", jp: "塩素", en: "Chlorine", group: "3", period: "17", row: 2, column: 16 },
            { num: 18, symbol: "Ar", jp: "アルゴン", en: "Argon", group: "3", period: "18", row: 2, column: 17 },
            { num: 19, symbol: "K", jp: "カリウム", en: "Potassium", group: "4", period: "1", row: 3, column: 0 },
            { num: 20, symbol: "Ca", jp: "カルシウム", en: "Calcium", group: "4", period: "2", row: 3, column: 1 },
            { num: 21, symbol: "Sc", jp: "スカンジウム", en: "Scandium", group: "4", period: "3", row: 3, column: 2 },
            { num: 22, symbol: "Ti", jp: "チタン", en: "Titanium", group: "4", period: "4", row: 3, column: 3 },
            { num: 23, symbol: "V", jp: "バナジウム", en: "Vanadium", group: "4", period: "5", row: 3, column: 4 },
            { num: 24, symbol: "Cr", jp: "クロム", en: "Chromium", group: "4", period: "6", row: 3, column: 5 },
            { num: 25, symbol: "Mn", jp: "マンガン", en: "Manganese", group: "4", period: "7", row: 3, column: 6 },
            { num: 26, symbol: "Fe", jp: "鉄", en: "Iron", group: "4", period: "8", row: 3, column: 7 },
            { num: 27, symbol: "Co", jp: "コバルト", en: "Cobalt", group: "4", period: "9", row: 3, column: 8 },
            { num: 28, symbol: "Ni", jp: "ニッケル", en: "Nickel", group: "4", period: "10", row: 3, column: 9 },
            { num: 29, symbol: "Cu", jp: "銅", en: "Copper", group: "4", period: "11", row: 3, column: 10 },
            { num: 30, symbol: "Zn", jp: "亜鉛", en: "Zinc", group: "4", period: "12", row: 3, column: 11 },
            { num: 31, symbol: "Ga", jp: "ガリウム", en: "Gallium", group: "4", period: "13", row: 3, column: 12 },
            { num: 32, symbol: "Ge", jp: "ゲルマニウム", en: "Germanium", group: "4", period: "14", row: 3, column: 13 },
            { num: 33, symbol: "As", jp: "ヒ素", en: "Arsenic", group: "4", period: "15", row: 3, column: 14 },
            { num: 34, symbol: "Se", jp: "セレン", en: "Selenium", group: "4", period: "16", row: 3, column: 15 },
            { num: 35, symbol: "Br", jp: "臭素", en: "Bromine", group: "4", period: "17", row: 3, column: 16 },
            { num: 36, symbol: "Kr", jp: "クリプトン", en: "Krypton", group: "4", period: "18", row: 3, column: 17 },
            { num: 37, symbol: "Rb", jp: "ルビジウム", en: "Rubidium", group: "5", period: "1", row: 4, column: 0 },
            { num: 38, symbol: "Sr", jp: "ストロンチウム", en: "Strontium", group: "5", period: "2", row: 4, column: 1 },
            { num: 39, symbol: "Y", jp: "イットリウム", en: "Yttrium", group: "5", period: "3", row: 4, column: 2 },
            { num: 40, symbol: "Zr", jp: "ジルコニウム", en: "Zirconium", group: "5", period: "4", row: 4, column: 3 },
            { num: 41, symbol: "Nb", jp: "ニオブ", en: "Niobium", group: "5", period: "5", row: 4, column: 4 },
            { num: 42, symbol: "Mo", jp: "モリブデン", en: "Molybdenum", group: "5", period: "6", row: 4, column: 5 },
            { num: 43, symbol: "Tc", jp: "テクネチウム", en: "Technetium", group: "5", period: "7", row: 4, column: 6 },
            { num: 44, symbol: "Ru", jp: "ルテニウム", en: "Ruthenium", group: "5", period: "8", row: 4, column: 7 },
            { num: 45, symbol: "Rh", jp: "ロジウム", en: "Rhodium", group: "5", period: "9", row: 4, column: 8 },
            { num: 46, symbol: "Pd", jp: "パラジウム", en: "Palladium", group: "5", period: "10", row: 4, column: 9 },
            { num: 47, symbol: "Ag", jp: "銀", en: "Silver", group: "5", period: "11", row: 4, column: 10 },
            { num: 48, symbol: "Cd", jp: "カドミウム", en: "Cadmium", group: "5", period: "12", row: 4, column: 11 },
            { num: 49, symbol: "In", jp: "インジウム", en: "Indium", group: "5", period: "13", row: 4, column: 12 },
            { num: 50, symbol: "Sn", jp: "スズ", en: "Tin", group: "5", period: "14", row: 4, column: 13 },
            { num: 51, symbol: "Sb", jp: "アンチモン", en: "Antimony", group: "5", period: "15", row: 4, column: 14 },
            { num: 52, symbol: "Te", jp: "テルル", en: "Tellurium", group: "5", period: "16", row: 4, column: 15 },
            { num: 53, symbol: "I", jp: "ヨウ素", en: "Iodine", group: "5", period: "17", row: 4, column: 16 },
            { num: 54, symbol: "Xe", jp: "キセノン", en: "Xenon", group: "5", period: "18", row: 4, column: 17 },
            { num: 55, symbol: "Cs", jp: "セシウム", en: "Caesium", group: "6", period: "1", row: 5, column: 0 },
            { num: 56, symbol: "Ba", jp: "バリウム", en: "Barium", group: "6", period: "2", row: 5, column: 1 },
            { num: 57, symbol: "La", jp: "ランタン", en: "Lanthanum", group: "6", period: "3L", row: 7, column: 2 },
            { num: 58, symbol: "Ce", jp: "セリウム", en: "Cerium", group: "6", period: "3L", row: 7, column: 3 },
            { num: 59, symbol: "Pr", jp: "プラセオジム", en: "Praseodymium", group: "6", period: "3L", row: 7, column: 4 },
            { num: 60, symbol: "Nd", jp: "ネオジム", en: "Neodymium", group: "6", period: "3L", row: 7, column: 5 },
            { num: 61, symbol: "Pm", jp: "プロメチウム", en: "Promethium", group: "6", period: "3L", row: 7, column: 6 },
            { num: 62, symbol: "Sm", jp: "サマリウム", en: "Samarium", group: "6", period: "3L", row: 7, column: 7 },
            { num: 63, symbol: "Eu", jp: "ユウロピウム", en: "Europium", group: "6", period: "3L", row: 7, column: 8 },
            { num: 64, symbol: "Gd", jp: "ガドリニウム", en: "Gadolinium", group: "6", period: "3L", row: 7, column: 9 },
            { num: 65, symbol: "Tb", jp: "テルビウム", en: "Terbium", group: "6", period: "3L", row: 7, column: 10 },
            { num: 66, symbol: "Dy", jp: "ジスプロシウム", en: "Dysprosium", group: "6", period: "3L", row: 7, column: 11 },
            { num: 67, symbol: "Ho", jp: "ホルミウム", en: "Holmium", group: "6", period: "3L", row: 7, column: 12 },
            { num: 68, symbol: "Er", jp: "エルビウム", en: "Erbium", group: "6", period: "3L", row: 7, column: 13 },
            { num: 69, symbol: "Tm", jp: "ツリウム", en: "Thulium", group: "6", period: "3L", row: 7, column: 14 },
            { num: 70, symbol: "Yb", jp: "イッテルビウム", en: "Ytterbium", group: "6", period: "3L", row: 7, column: 15 },
            { num: 71, symbol: "Lu", jp: "ルテチウム", en: "Lutetium", group: "6", period: "3L", row: 7, column: 16 },
            { num: 72, symbol: "Hf", jp: "ハフニウム", en: "Hafnium", group: "6", period: "4", row: 5, column: 3 },
            { num: 73, symbol: "Ta", jp: "タンタル", en: "Tantalum", group: "6", period: "5", row: 5, column: 4 },
            { num: 74, symbol: "W", jp: "タングステン", en: "Tungsten", group: "6", period: "6", row: 5, column: 5 },
            { num: 75, symbol: "Re", jp: "レニウム", en: "Rhenium", group: "6", period: "7", row: 5, column: 6 },
            { num: 76, symbol: "Os", jp: "オスミウム", en: "Osmium", group: "6", period: "8", row: 5, column: 7 },
            { num: 77, symbol: "Ir", jp: "イリジウム", en: "Iridium", group: "6", period: "9", row: 5, column: 8 },
            { num: 78, symbol: "Pt", jp: "白金", en: "Platinum", group: "6", period: "10", row: 5, column: 9 },
            { num: 79, symbol: "Au", jp: "金", en: "Gold", group: "6", period: "11", row: 5, column: 10 },
            { num: 80, symbol: "Hg", jp: "水銀", en: "Mercury", group: "6", period: "12", row: 5, column: 11 },
            { num: 81, symbol: "Tl", jp: "タリウム", en: "Thallium", group: "6", period: "13", row: 5, column: 12 },
            { num: 82, symbol: "Pb", jp: "鉛", en: "Lead", group: "6", period: "14", row: 5, column: 13 },
            { num: 83, symbol: "Bi", jp: "ビスマス", en: "Bismuth", group: "6", period: "15", row: 5, column: 14 },
            { num: 84, symbol: "Po", jp: "ポロニウム", en: "Polonium", group: "6", period: "16", row: 5, column: 15 },
            { num: 85, symbol: "At", jp: "アスタチン", en: "Astatine", group: "6", period: "17", row: 5, column: 16 },
            { num: 86, symbol: "Rn", jp: "ラドン", en: "Radon", group: "6", period: "18", row: 5, column: 17 },
            { num: 87, symbol: "Fr", jp: "フランシウム", en: "Francium", group: "7", period: "1", row: 6, column: 0 },
            { num: 88, symbol: "Ra", jp: "ラジウム", en: "Radium", group: "7", period: "2", row: 6, column: 1 },
            { num: 89, symbol: "Ac", jp: "アクチニウム", en: "Actinium", group: "7", period: "3A", row: 8, column: 2 },
            { num: 90, symbol: "Th", jp: "トリウム", en: "Thorium", group: "7", period: "3A", row: 8, column: 3 },
            { num: 91, symbol: "Pa", jp: "プロトアクチニウム", en: "Protactinium", group: "7", period: "3A", row: 8, column: 4 },
            { num: 92, symbol: "U", jp: "ウラン", en: "Uranium", group: "7", period: "3A", row: 8, column: 5 },
            { num: 93, symbol: "Np", jp: "ネプツニウム", en: "Neptunium", group: "7", period: "3A", row: 8, column: 6 },
            { num: 94, symbol: "Pu", jp: "プルトニウム", en: "Plutonium", group: "7", period: "3A", row: 8, column: 7 },
            { num: 95, symbol: "Am", jp: "アメリシウム", en: "Americium", group: "7", period: "3A", row: 8, column: 8 },
            { num: 96, symbol: "Cm", jp: "キュリウム", en: "Curium", group: "7", period: "3A", row: 8, column: 9 },
            { num: 97, symbol: "Bk", jp: "バークリウム", en: "Berkelium", group: "7", period: "3A", row: 8, column: 10 },
            { num: 98, symbol: "Cf", jp: "カリホルニウム", en: "Californium", group: "7", period: "3A", row: 8, column: 11 },
            { num: 99, symbol: "Es", jp: "アインスタイニウム", en: "Einsteinium", group: "7", period: "3A", row: 8, column: 12 },
            { num: 100, symbol: "Fm", jp: "フェルミウム", en: "Fermium", group: "7", period: "3A", row: 8, column: 13 },
            { num: 101, symbol: "Md", jp: "メンデレビウム", en: "Mendelevium", group: "7", period: "3A", row: 8, column: 14 },
            { num: 102, symbol: "No", jp: "ノーベリウム", en: "Nobelium", group: "7", period: "3A", row: 8, column: 15 },
            { num: 103, symbol: "Lr", jp: "ローレンシウム", en: "Lawrencium", group: "7", period: "3A", row: 8, column: 16 },
            { num: 104, symbol: "Rf", jp: "ラザホージウム", en: "Rutherfordium", group: "7", period: "4", row: 6, column: 3 },
            { num: 105, symbol: "Db", jp: "ドブニウム", en: "Dubnium", group: "7", period: "5", row: 6, column: 4 },
            { num: 106, symbol: "Sg", jp: "シーボーギウム", en: "Seaborgium", group: "7", period: "6", row: 6, column: 5 },
            { num: 107, symbol: "Bh", jp: "ボーリウム", en: "Bohrium", group: "7", period: "7", row: 6, column: 6 },
            { num: 108, symbol: "Hs", jp: "ハッシウム", en: "Hassium", group: "7", period: "8", row: 6, column: 7 },
            { num: 109, symbol: "Mt", jp: "マイトネリウム", en: "Meitnerium", group: "7", period: "9", row: 6, column: 8 },
            { num: 110, symbol: "Ds", jp: "ダームスタチウム", en: "Darmstadtium", group: "7", period: "10", row: 6, column: 9 },
            { num: 111, symbol: "Rg", jp: "レントゲニウム", en: "Roentgenium", group: "7", period: "11", row: 6, column: 10 },
            { num: 112, symbol: "Cn", jp: "コペルニシウム", en: "Copernicium", group: "7", period: "12", row: 6, column: 11 },
            { num: 113, symbol: "Nh", jp: "ニホニウム", en: "Nihonium", group: "7", period: "13", row: 6, column: 12 },
            { num: 114, symbol: "Fl", jp: "フレロビウム", en: "Flerovium", group: "7", period: "14", row: 6, column: 13 },
            { num: 115, symbol: "Mc", jp: "モスコビウム", en: "Moscovium", group: "7", period: "15", row: 6, column: 14 },
            { num: 116, symbol: "Lv", jp: "リバモリウム", en: "Livermorium", group: "7", period: "16", row: 6, column: 15 },
            { num: 117, symbol: "Ts", jp: "テネシン", en: "Tennessine", group: "7", period: "17", row: 6, column: 16 },
            { num: 118, symbol: "Og", jp: "オガネソン", en: "Oganesson", group: "7", period: "18", row: 6, column: 17 }
        ];

        //////////////////////////////////////////////////////////////// 
        //////////////////////////////////////////////////////////////// 
        ////                      Cookie 関連                       ////
        ////////////////////////////////////////////////////////////////
        //////////////////////////////////////////////////////////////// 

        // Cookieに格納されたデータをmapにして返す
        function getMapFromCookie() {
            let map = new Map();
            for(const data of document.cookie.split('; ')) {
                const splitdata = data.split('=');
                if(splitdata.length < 2) continue;
                const attr = splitdata[0];
                const val  = unescape(splitdata[1]);
                map.set(attr, val);
            }
            return map;
        }

        // Cookieに値を登録する
        function setAttribute(key, val) {
            const presentDay = new Date();
            const dd = presentDay.getDate() + 7;
            presentDay.setDate(dd);
            const expTime = presentDay.toGMTString(); // ここまで有効期限の計算
            document.cookie = key + "=" + escape(val) + "; expires=" + expTime; // 登録 
        }
        
        // Cookieに登録されたあるキーの値を返す
        function getAttribute(attr) {
            let map = getMapFromCookie();
            return map.get(attr);
        }

        // Cookieにその属性が存在するかを返す
        function cookieContains(attr) {
            let map = getMapFromCookie();
            return map.has(attr) && map.get(attr) != '';
        }

        // クイズのモードとそれに対応する元素のキー名を取得
        function elementCookieKey(mode, element) {
            const symbol = element.symbol;
            switch(mode) {
                case SYMBOL_TO_JA_NAME:
                    return "s2j_" + element.symbol;
                case SYMBOL_TO_EN_NAME:
                    return "s2e_" + element.symbol;
                case JA_NAME_TO_SYMBOL:
                    return "j2s_" + element.symbol;
                case EN_NAME_TO_SYMBOL:
                    return "e2s_" + element.symbol;
                default:
                    return "";
            }
        }

        //////////////////////////////////////////////////////////////// 
        //////////////////////////////////////////////////////////////// 
        ////                      周期表 関連                       ////
        ////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////

        // クイズのモードに対応する周期表のタイトルを取得する
        function getElementTableTitle(mode) {
            const title = "覚えた元素表 ";
            switch(mode) {
                case SYMBOL_TO_JA_NAME:
                    return title + "(記号→日本語)";
                case SYMBOL_TO_EN_NAME:
                    return title + "(記号→英語)";
                case JA_NAME_TO_SYMBOL:
                    return title + "(日本語→記号)";
                case EN_NAME_TO_SYMBOL:
                    return title + "(英語→記号)";
                default:
                    return "";
            }
        }

        // 周期表で表示する情報の種類を取得
        function getElementsTableMode() {
            // クイズ中でなければプルダウンメニューで選択されているもの
            if(quizMode == NOT_PLAYING_GAME) {
                const selected = document.quizmenu.quizes.selectedIndex;
                return parseInt(document.quizmenu.quizes.options[selected].value);
            } 
            // クイズ中であればクイズの種類を返す
            else {
                return quizMode;
            }
        }

        // 周期表の内容を更新
        function updateElementsTable() {

            // 周期表の二次元配列を作る
            let elements2d = Array(9);
            for(let i = 0; i < 9; i++) elements2d[i] = Array(18);
            for(let i = 0; i < elements.length; i++) {
                const ele = elements[i];
                elements2d[ele.row][ele.column] = ele;
            }

            let html = '';
            // 正解か不正解かの情報がCookieに書かれているのでそれを取得
            const cookieMap = getMapFromCookie();
            const mode = getElementsTableMode();

            for(let i = 0; i < elements2d.length; i++) {
                html += '<tr>';
                for(let j = 0; j < elements2d[i].length; j++) {

                    // 周期表のその位置に元素がなければスキップ
                    if(elements2d[i][j] == null) { html += '<td></td>'; continue; }

                    // 正解であれば緑、不正解であればオレンジ、未挑戦ならば灰色で表示
                    let className;
                    const hasKey = cookieMap.has(elementCookieKey(mode, elements2d[i][j]));
                    if(hasKey) {
                        const status = cookieMap.get(elementCookieKey(mode, elements2d[i][j]));
                        className = status == 'AC' ? 'remembered_element' : 'wrong_answered_element';
                    } else {
                        className = 'unknown_element';
                    }

                    html += `<td class="element_table_td ${className}">${elements2d[i][j].symbol}</td>`;
                }
                html += '</tr>';
            }
            document.getElementById('elements_table').innerHTML = html;
            document.getElementById('elements_table_title').innerText = getElementTableTitle(mode);
        }

        //////////////////////////////////////////////////////////////// 
        //////////////////////////////////////////////////////////////// 
        ////                 元素ランダム表示 関連                  ////
        ////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////

        let prioritizeWrongAnswerAndUnquestioned = false; // 誤答, 未回答 を優先する

        let priorityElements = Array();

        function buildPriorityQuestionList() {
            const cookieMap = getMapFromCookie();
            const mode = getElementsTableMode();
            priorityElements = Array();
            for(let i = 0; i < elements.length; i++) {
                const hasKey = cookieMap.has(elementCookieKey(mode, elements[i]));
                if(hasKey) {
                    const status = cookieMap.get(elementCookieKey(mode, elements[i]));
                    if(status == "WA") {
                        priorityElements.push(elements[i]);
                    }
                } else {
                    priorityElements.push(elements[i]);
                }
            }
        }

        // 優先する元素を1つランダムに返す
        function getPriorityElements() {
            buildPriorityQuestionList();
            if(priorityElements.length == 0) {
                return getRandomElement(true);
            } else {
                return priorityElements[parseInt(Math.random() * priorityElements.length)];
            }
        }

        // ランダムに1つ元素の情報を返す
        function getRandomElement(enforceRandom = false) {
            const prioritizeWA = document.quizmenu.prioritizeWA.checked;
            if(!enforceRandom && prioritizeWA) {
                return getPriorityElements();
            }
            let idx;
            do {
                idx = parseInt(Math.random() * 118);
            } while(currentElement != null && currentElement.num - 1 == idx);
            return elements[idx];
        }

        //////////////////////////////////////////////////////////////// 
        //////////////////////////////////////////////////////////////// 
        ////                      クイズ 関連                       ////
        ////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////

        let quizMode = 0;
        const NOT_PLAYING_GAME = 0;
        const SYMBOL_TO_JA_NAME = 1;
        const SYMBOL_TO_EN_NAME = 2;
        const JA_NAME_TO_SYMBOL = 3;
        const EN_NAME_TO_SYMBOL = 4;

        let answeredQuestions = [];

        function getCurrentQuestionText() {
            switch(quizMode) {
                case SYMBOL_TO_JA_NAME:
                case SYMBOL_TO_EN_NAME:
                    return currentElement.symbol;
                case JA_NAME_TO_SYMBOL:
                    return currentElement.jp;
                case EN_NAME_TO_SYMBOL:
                    return currentElement.en;
                default:
                    return '';
            }
        }

        function appendAnsweredQuestion(playersAnswer) {
            answeredQuestions.push({
                correct: playersAnswer == getCurrentAnswerKey(),
                question: getCurrentQuestionText(),
                response: playersAnswer,
                answer: getCurrentAnswerKey()
            });
        }

        function sanitaize(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
        }

        function buildErrata() {
            if(answeredQuestions.length == 0) {
                document.getElementById('quiz_result_table').innerHTML = '';
                return;
            }
            let html = '';
            html += '<tr><th>正誤</th><th>問題</th><th>正解</th><th>あなたの回答</th></tr>';
            for(const result of answeredQuestions) {
                html += '<tr>';
                const className = result.correct ? 'correct_sign' : 'incorrect_sign';
                const status = result.correct ? '正解' : '不正解';
                html += `<td><span class="${className}">${status}</span></td>`;
                html += `<td>${result.question}</td>`;
                html += `<td>${result.answer}</td>`;
                html += `<td>${sanitaize(result.response)}</td>`;
                html += '</tr>';
            }
            document.getElementById('quiz_result_table').innerHTML = html;
        }

        // ゲームを開始
        function startQuiz() {
            questionNumber = 0;
            const selected = document.quizmenu.quizes.selectedIndex;
            quizMode = parseInt(document.quizmenu.quizes.options[selected].value);

            setElementViewVisibilityOfQuiz();
            setAnswerBoxPlaceholder();

            setDisplay('quiz', 'block');
            setDisplay('menu', 'none');
            showElementRandomly();
        }

        // ゲームを終了
        function closeQuiz() {
            quizMode = NOT_PLAYING_GAME;
            buildErrata();

            setDisplay('quiz', 'none');
            setDisplay('menu', 'block');
            setElementViewVisibility(false, true, true, true, true);
        }

        // 回答欄のプレースホルダを設定
        function setAnswerBoxPlaceholder() {
            switch(quizMode) {
                case SYMBOL_TO_JA_NAME:
                    document.quizOperationBoard.answer.placeholder = "日本語名"; break;
                case SYMBOL_TO_EN_NAME:
                    document.quizOperationBoard.answer.placeholder = "英語名 (IUPAC名, 先頭大文字)"; break;
                case JA_NAME_TO_SYMBOL:
                case EN_NAME_TO_SYMBOL:
                    document.quizOperationBoard.answer.placeholder = "元素記号"; break;
                default:
                    quizMode = NOT_PLAYING_GAME; return;
            }
        }

        // 出題欄に表示する情報の設定
        function setElementViewVisibilityOfQuiz() {
            switch(quizMode) {
                case SYMBOL_TO_JA_NAME:
                case SYMBOL_TO_EN_NAME:
                    setElementViewVisibility(true, true, true, false, false); break;
                case JA_NAME_TO_SYMBOL:
                    setElementViewVisibility(true, true, false, false, true); break;
                case EN_NAME_TO_SYMBOL:
                    setElementViewVisibility(true, true, false, true, false); break;
                default:
                    quizMode = NOT_PLAYING_GAME; return;
            }
        }

        // 解説を設定
        function setEditorial(correct, element) {
            const resultClassName = correct ? "correct_sign" : "incorrect_sign";
            document.getElementById('quiz_result').className = resultClassName;
            document.getElementById('quiz_result').innerText = correct ? '正解' : '不正解';
            let msg = '';
            switch(quizMode) {
                case SYMBOL_TO_JA_NAME:
                    msg = `${element.symbol} は <strong>${element.jp}</strong> (${element.en}) の元素記号です。`; break;
                case SYMBOL_TO_EN_NAME:
                    msg = `${element.symbol} は <strong>${element.en}</strong> (${element.jp}) の元素記号です。`; break;
                case JA_NAME_TO_SYMBOL:
                    msg = `${element.jp} (${element.en}) の元素記号は <strong>${element.symbol}</strong> です。`; break;
                case EN_NAME_TO_SYMBOL:
                    msg = `${element.en} (${element.jp}) の元素記号は <strong>${element.symbol}</strong> です。`; break;
                default:
                    break;
            }
            document.getElementById('editorial').innerHTML = msg;
        }

        // 現在のクイズのモードに対応する答えを返す
        function getCurrentAnswerKey() {
            switch(quizMode) {
                case SYMBOL_TO_JA_NAME:
                    return currentElement.jp;
                case SYMBOL_TO_EN_NAME:
                    return currentElement.en;
                case JA_NAME_TO_SYMBOL:
                case EN_NAME_TO_SYMBOL:
                    return currentElement.symbol;
                default:
                    return "";
            }
        }

        // クイズに答える
        function answerQuiz() {
            const response = document.quizOperationBoard.answer.value;
            if(response == getCurrentAnswerKey()) {
                setAttribute(elementCookieKey(quizMode, currentElement), "AC");
            } else {
                setAttribute(elementCookieKey(quizMode, currentElement), "WA");
            }
            document.quizOperationBoard.answer.value = "";
            setEditorial(response == getCurrentAnswerKey(), currentElement);
            appendAnsweredQuestion(response);
            updateElementsTable();
            showElementRandomly();
        }

        //////////////////////////////////////////////////////////////// 
        //////////////////////////////////////////////////////////////// 
        ////                         その他                         ////
        ////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////////////////////////

        

        // 画面上部に指定した元素の情報を表示する
        function showElement(ele) {
            document.getElementById('question_number').innerText = '第' + questionNumber + '問';
            document.getElementById('element_view_number').innerText = 'No.' + ele.num;
            document.getElementById('element_view_symbol').innerText = ele.symbol;
            document.getElementById('element_view_en').innerText = ele.en;
            document.getElementById('element_view_jp').innerText = ele.jp;
        }

        // 問題番号, 元素番号, 元素記号, 英語名, 日本語名 の表示/非表示を切り替える
        function setElementViewVisibility(qnum, num, sym, en, jp) {
            setDisplay('question_number', qnum ? 'inline-block' : 'none');
            setDisplay('element_view_number', num ? 'inline-block' : 'none');
            setDisplay('element_view_symbol', sym ? 'inline-block' : 'none');
            setDisplay('element_view_en', en ? 'inline-block' : 'none');
            setDisplay('element_view_jp', jp ? 'inline-block' : 'none');
            setDisplay('element_view', qnum || num || sym || en || jp ? 'block' : 'none');
        }
        function setDisplay(id, state) {
            document.getElementById(id).style.display = state;
        }

        let currentElement;
        let questionNumber = 0;
        function showElementRandomly() {
            currentElement = getRandomElement();
            questionNumber++;
            showElement(currentElement);
        }

        // 学習用に元素をランダムに表示
        function showElementRandomlyForLearning() {
            setElementViewVisibility(false, true, true, true, true);
            showElementRandomly();
        }
    </script>

    <script type="text/javascript" id="script_area"></script>
</head>

<body style="text-align:center">
    <h1>元素記号学習サイト</h1>
    <p>
        元素記号をクイズ形式で覚えましょう。
    </p>

    <div id="element_view" style="display: none">
        <p id="question_number"></p>
        <p id="element_view_number"></p>
        <p id="element_view_symbol"></p>
        <p id="element_view_en"></p>
        <p id="element_view_jp"></p>
    </div>

    <div id="quiz" style="display: none">
        <p>
            <span id="quiz_result"></span> <span id="editorial"></span>
        </p>
        <form name="quizOperationBoard" onsubmit="return false;">
            <input type="text" name="answer">
            <input type="submit" value="回答" onclick="answerQuiz()">
            <input type="button" onclick="closeQuiz()" value="クイズを終了">
        </form>
    </div>

    <div id="menu">
        <p>
            <button onclick="showElementRandomlyForLearning()">ランダムに表示</button>
        </p>
        <form name="quizmenu">
            <p>
                <select name="quizes" onchange="updateElementsTable()">
                    <option value="1">記号から日本語名</option>
                    <option value="2">記号から英語名(IUPAC名)</option>
                    <option value="3">日本語名から記号</option>
                    <option value="4">英語名(IUPAC名)から記号</option>
                </select>
                <input type="button" value="クイズを開始" onclick="startQuiz()">
            </p>
            <p>
                <input type="checkbox" name="prioritizeWA">不正解/未回答を優先的に出題
            </p>
        </form>

        <p>
            <table id="quiz_result_table" align="center"></table>
        </p>
    </div>

    <div id="elements_table_wrapper">
        <h2 id="elements_table_title">覚えた元素表</h2>
        <table id="elements_table" align="center"></table>
    </div>

    <script>
        updateElementsTable();
        showElementRandomlyForLearning();
    </script>
</body>

</html>
